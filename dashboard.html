<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>داشبورد - ویرایشگر مانگا</title>
  <style>
    body { margin:0; height:100vh; background:#0b0b0b; color:#eee; font-family: system-ui, sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; }
    .token-box { background:#1a1a1a; border:1px solid #444; padding:1.2rem 2.5rem; border-radius:12px; margin-bottom:2rem; }
    #tokenCount { font-weight:bold; color:#0af; font-size:1.5rem; }
    .glow-button { background:#0af; color:white; border:none; padding:1.2rem 3rem; border-radius:999px; font-size:1.2rem; font-weight:bold; cursor:pointer; box-shadow:0 0 20px rgba(0,170,255,0.4); transition:0.3s; }
    .glow-button:hover { transform:scale(1.05); }
    .glow-button:disabled { background:#555; cursor:not-allowed; box-shadow:none; }
    .info { max-width:400px; color:#888; margin-top:20px; font-size:0.9rem; }
  </style>
</head>
<body onload="updateUI()">

  <h1>پنل کاربری</h1>
  
  <div class="token-box">
    تعداد توکن‌های شما: <span id="tokenCount">0</span>
  </div>

  <button id="startBtn" class="glow-button" onclick="startEditor()">ورود به ویرایشگر</button>

  <div class="info">
    با هر بار ورود، ۱ توکن کسر شده و 1 ساعت فرصت ویرایش دارید.
  </div>

  <script>
    function updateUI() {
      const auth = JSON.parse(localStorage.getItem("mangaEditorAuth"));
      if (!auth) { window.location.href = "login.html"; return; }
      
      document.getElementById("tokenCount").innerText = auth.tokens;
      
      // اگر توکن تمام شده باشد دکمه غیرفعال شود
      if (auth.tokens <= 0) {
        document.getElementById("startBtn").disabled = true;
        document.getElementById("startBtn").innerText = "توکن کافی ندارید";
      }
    }

    function startEditor() {
      const auth = JSON.parse(localStorage.getItem("mangaEditorAuth"));
      
      // ۱. کسر یک توکن
      auth.tokens -= 1;
      localStorage.setItem("mangaEditorAuth", JSON.stringify(auth));

      // ۲. ایجاد جلسه ۶ ساعته
      const session = {
        expire: Date.now() + (1 * 60 * 60 * 1000) // ۶ ساعت بعد
      };
      localStorage.setItem("mangaEditorSession", JSON.stringify(session));

      // ۳. انتقال به ویرایشگر
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
